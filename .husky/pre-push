echo "ğŸ” Validating staging build before push..."

cd client

# Check if node_modules exists, if not install dependencies
if [ ! -d "node_modules" ]; then
  echo "ğŸ“¦ Installing client dependencies..."
  npm ci
fi

# Run TypeScript type checking (this will catch type errors in both client and server code)
echo "ğŸ” Running TypeScript type check..."
npx tsc -b

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed! Push aborted."
  exit 1
fi

# Run staging build validation
echo "ğŸ—ï¸  Building client for staging..."
NODE_ENV=staging vite build --mode staging

if [ $? -eq 0 ]; then
  echo "âœ… Staging build validation passed!"
else
  echo "âŒ Staging build validation failed! Push aborted."
  exit 1
fi

