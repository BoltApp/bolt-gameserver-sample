#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Validating staging build before push..."

cd client

# Check if node_modules exists, if not install dependencies
if [ ! -d "node_modules" ]; then
  echo "ğŸ“¦ Installing client dependencies..."
  npm ci
fi

# Run staging build validation
echo "ğŸ—ï¸  Building client for staging..."
npm run build:staging

if [ $? -eq 0 ]; then
  echo "âœ… Staging build validation passed!"
else
  echo "âŒ Staging build validation failed! Push aborted."
  exit 1
fi

